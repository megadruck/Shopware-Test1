//{namespace name="backend/viison_shipping_common_order/order"}
Ext.define("Shopware.apps.ViisonShippingCommonOrder.controller.Tab",{ extend:"Shopware.apps.ViisonShippingCommonOrder.controller.ShippingLabels",init:function(){ var e=this;e.control({ "order-detail-window tabpanel[name=main-tab]":{ afterrender:e.onAfterRender}});e.labelPanelSelector="order-detail-window "+e.dispatchServiceProviderPanelClass;e.callParent(arguments)},onAfterRender:function(e){ var i=this;var a=e.down(i.dispatchServiceProviderPanelClass);var r=a.shippingLabelStore;r.on("load",function(e){ i.updateAddLabelButton(a)},this,{ single:true});if(i.subApplication.params&&i.subApplication.params.focus==i.dispatchServiceProviderPanelClass&&i.subApplication.params.showLabelConfirmWindow){ r.on("load",function(r){ i.onShowLabelConfirmWindow(a,e.up("order-detail-window").record,r)},this,{ single:true})}},updateAddLabelButton:function(e){ var i=e.addLabelButton;var a=e.shippingLabelStore.count()>=this.maxNumberOfLabels;i.setDisabled(a);i.setTooltip(!a?i.enabledTooltip:i.disabledTooltip)},updateProduct:function(e){ var i=this;Ext.Ajax.request({ url:i.getProductURL,params:{ orderId:e.getId()},success:function(a){ var a=Ext.JSON.decode(a.responseText);e[i.dispatchServiceProviderPrefix]=e[i.dispatchServiceProviderPrefix]||{ };e[i.dispatchServiceProviderPrefix]=Ext.apply(e[i.dispatchServiceProviderPrefix],a.data);if(i.getLabelConfirmWindow()&&i.getLabelConfirmWindow().dataPanel){ i.getLabelConfirmWindow().dataPanel.setValues()}}})},updateIsCashOnDelivery:function(e){ var i=this;Ext.Ajax.request({ url:'{url controller="ViisonShippingCommonOrder" action="getIsCashOnDelivery"}',params:{ orderId:e.getId()},success:function(a){ var r=Ext.JSON.decode(a.responseText);e[i.dispatchServiceProviderPrefix]=e[i.dispatchServiceProviderPrefix]||{ };e[i.dispatchServiceProviderPrefix].isCashOnDelivery=r.isCashOnDelivery;if(i.getLabelConfirmWindow()&&i.getLabelConfirmWindow().dataPanel){ i.getLabelConfirmWindow().dataPanel.setValues()}}})},updateOrderTrackingCodes:function(e,i,a){ var r=e.up("order-detail-window");i.set("trackingCode",a);var t=r.down("component[cls="+Ext.baseCSSPrefix+"overview-panel] [name='trackingCode']");if(t){ t.setValue(a)}},updateOrderShippingAddress:function(e,i,a){ var r=i.getShipping().findRecord("orderId",i.getId());r.set(a);var t=e.down("component[cls="+Ext.baseCSSPrefix+"detail-panel]");if(t){ var n=t.items.findBy(function(e,i){ return e.id.indexOf("shipping-field-set")!==-1});n.items.each(function(e){ e.items.each(function(e){ var i=e.name.substring(e.name.indexOf("[")+1,e.name.length-1);e.setValue(r.get(i))})})}},onShowOrder:function(e){ this.loadDataForOrder(e)},loadDataForOrder:function(e){ var i=this;i.updateStreet(e);i.updateOrderWeight(e);i.updateRequiredFields(e);i.updateProduct(e);i.updateIsCashOnDelivery(e)}});
